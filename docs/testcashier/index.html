<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Hamilton Deli & Grill — Concierge</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">

<style>
  :root {
      --bg-color: #F8F8F6;
      --primary-text-color: #1D1D1F;
      --secondary-text-color: #6E6E73;
      --accent-gradient: linear-gradient(45deg, #0A84FF, #0060CE);
      --accent-color-start: #0A84FF;
      --border-color: #d2d2d7;
      --card-bg-color: #FFFFFF;
      --input-bg: #FFFFFF;
      --font-family: 'Inter', ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  }
  html, body {
    margin:0;
    background: var(--bg-color);
    color: var(--primary-text-color);
    font-family: var(--font-family);
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }
  body {
      padding-bottom: 40px; /* Space for the SOP card */
  }
  
  #particles-js {
    position: fixed;
    width: 100%;
    height: 100%;
    top: 0;
    left: 0;
    z-index: -1;
  }
  
  .wrap{max-width:940px;margin:32px auto;padding:0 18px}
  
  .header-info {
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-wrap: wrap;
      gap: 1rem;
      color: var(--secondary-text-color);
      font-size: 14px;
      font-weight: 500;
      margin-bottom: 16px;
      position: relative;
  }
  .weather-widget {
      display: flex;
      align-items: center;
      gap: 0.5rem;
  }

  .live-clock {
    text-align: right;
  }
  
  .card{
    background: var(--card-bg-color);
    border-radius: 24px;
    padding: 24px;
    position: relative;
    border: 1px solid var(--border-color);
    margin-bottom: 24px;
    box-shadow: 0 10px 30px rgba(0,0,0,.07);
  }

  .card.screen {
    transition: opacity 0.4s ease-in-out, transform 0.4s ease-in-out;
  }
  .card.screen.hidden {
    opacity: 0;
    transform: translateY(20px);
    pointer-events: none;
    position: absolute;
    width: calc(100% - 36px);
    left: 18px;
  }

  h1 {
    margin:0 0 4px;
    font-weight:800;
    font-size: 28px;
    letter-spacing:-.5px;
    color: var(--accent-color-start);
    min-height: 40px; /* Reserve space to prevent layout shift */
  }
  h1 .char {
    display: inline-block;
    opacity: 0;
    transform: translateY(-20px);
    animation: char-enter 0.5s cubic-bezier(0.215, 0.61, 0.355, 1) forwards;
  }
  @keyframes char-enter { to { opacity: 1; transform: translateY(0); } }

  h2{margin:0 0 6px;font-weight:700; font-size: 24px;}
  .sub{color: var(--secondary-text-color);margin-bottom:24px; font-size: 16px;}

  .grid{display:grid;gap:18px}
  .two{grid-template-columns:1fr 1fr}
  .three{grid-template-columns:1fr 1fr 1fr}
  
  .field{display:flex;flex-direction:column;gap:8px}
  label{font-weight:700; font-size: 15px; color: var(--primary-text-color);}
  
  input[type="tel"],input[type="number"],input[type="text"]{
    background:var(--input-bg);
    color: var(--primary-text-color);
    border:1px solid var(--border-color);
    border-radius:12px;
    padding:14px;
    font-size:16px;
    outline:none;
    transition: all 0.2s ease-in-out;
  }
  input:focus{
    box-shadow:0 0 0 3px rgba(10, 132, 255, 0.2);
    border-color: var(--accent-color-start);
  }
  .hint{color:var(--secondary-text-color);font-size:14px}
  
  .tiles{display:flex;flex-wrap:wrap;gap:10px}
  .tile{
    padding:10px 14px;
    border:1px solid var(--border-color);
    border-radius:12px;
    cursor:pointer;
    user-select:none;
    background: #f0f0ed;
    color: var(--primary-text-color);
    font-weight:700;
    transition: all 0.2s ease-in-out;
  }
  .tile:hover{background: #e9e9e7; border-color: #c0c0c0;}
  .tile.sel{
      border-color: var(--accent-color-start);
      background: #e6f3ff;
      color: #0052cc;
  }
  
  .row{display:flex;align-items:center;gap:10px}
  
  .actions{margin-top:24px;display:flex;gap:12px;flex-wrap:wrap}
  button{padding:14px 20px;border:none;border-radius:12px;font-weight:700;font-size:16px;cursor:pointer; transition: all 0.2s ease-in-out; display: inline-flex; align-items: center; justify-content: center;}
  .primary{
      background: var(--accent-gradient);
      color: #fff;
      box-shadow: 0 4px 15px rgba(0, 113, 227, 0.2);
  }
  .primary:hover{transform: scale(1.03);}
  .ghost{
      background: #e9e9e7;
      color: var(--primary-text-color);
      border: 1px solid var(--border-color);
  }
  .ghost:hover{background: #dcdcdc;}
  button[disabled]{opacity:.5;cursor:not-allowed; filter: grayscale(50%); transform: none;}
  
  .banner{
    display:none;
    margin-bottom:20px;
    padding:12px 16px;
    border-radius:12px;
    font-weight:700;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .banner .icon { width: 20px; height: 20px; }
  .ok{background:#e6f4ea; color:#1e4620; border:1px solid #a3d9b3;}
  .warn{background:#fff8e6; color:#66460d; border:1px solid #ffdab3;}
  .err{background:#fbeae5; color:#8a260c; border:1px solid #f5b8a5;}
  
  .kpi{display:flex;flex-wrap:wrap;gap:10px;margin:8px 0 2px}
  .chip{
    padding:8px 12px;
    border-radius:10px;
    background: #e9e9e7;
    border:1px solid var(--border-color);
    color: var(--primary-text-color);
    font-weight:700;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .chip .icon { width: 16px; height: 16px; opacity: 0.7; }
  .chip.badge{
      background:#e6f4ea; 
      border-color:#a3d9b3;
      color:#1e4620;
  }
  
  .summary{
      background: #f9f9f7;
      border:1px solid var(--border-color);
      border-radius:12px;
      padding:16px
  }
  .muted{color: var(--secondary-text-color)}
  .big{font-size:22px;font-weight:800}
  .right{margin-left:auto}
  
  .summary .right.updated {
    animation: highlight 0.5s ease-out;
  }
  @keyframes highlight {
    0%, 100% { color: var(--primary-text-color); transform: scale(1); }
    50% { color: var(--accent-color-start); transform: scale(1.08); }
  }

  hr{border:none;border-top:1px solid var(--border-color);margin:12px 0}
  
  .loading[hidden]{display:none !important;}
  .loading{
    position:absolute;
    inset:0;
    background:rgba(248, 248, 246, 0.65);
    backdrop-filter:blur(2px);
    border-radius:24px;
    display:flex;
    align-items:center;
    justify-content:center;
    gap:12px;
    z-index:5;
    font-size: 18px;
    font-weight: 500;
  }
  .spinner{
      width:24px;
      height:24px;
      border-radius:50%;
      border:4px solid rgba(10, 132, 255, 0.2);
      border-top-color: var(--accent-color-start);
      animation:spin .9s linear infinite;
  }
  @keyframes spin{to{transform:rotate(360deg)}}
  
  .styled-checkbox-wrap {
    position: relative;
    display: flex;
    align-items: center;
    cursor: pointer;
    user-select: none;
    gap: 10px;
  }
  .styled-checkbox-wrap input[type="checkbox"] {
    position: absolute;
    opacity: 0;
    cursor: pointer;
    height: 0;
    width: 0;
  }
  .checkmark {
    height: 22px;
    width: 22px;
    background-color: var(--input-bg);
    border: 1px solid var(--border-color);
    border-radius: 6px;
    transition: all 0.2s ease;
    display: inline-block;
    flex-shrink: 0;
  }
  .styled-checkbox-wrap:hover input ~ .checkmark {
    border-color: #a0a0a0;
  }
  .styled-checkbox-wrap input:checked ~ .checkmark {
    background-color: var(--accent-color-start);
    border-color: var(--accent-color-start);
  }
  .checkmark:after {
    content: "";
    position: absolute;
    display: none;
    left: 7px;
    top: 3px;
    width: 6px;
    height: 12px;
    border: solid white;
    border-width: 0 3px 3px 0;
    transform: rotate(45deg);
  }
  .styled-checkbox-wrap input:checked ~ .checkmark:after {
    display: block;
  }
  .styled-checkbox-wrap[data-disabled="true"] {
    opacity: 0.6;
    cursor: not-allowed;
  }

  /* --- ACCORDION CARD STYLES (SOP & HOLIDAYS) --- */
  .accordion-card { padding: 1.5rem 1.5rem 0.5rem; }
  .accordion-toggle {
      background: none;
      border: none;
      width: 100%;
      display: flex;
      justify-content: space-between;
      align-items: center;
      cursor: pointer;
      padding: 0 0.5rem 1rem;
  }
  .accordion-toggle h2 { font-size: 1.25rem; margin: 0; color: var(--primary-text-color); }
  .accordion-toggle .icon {
      font-size: 1rem;
      transition: transform 0.3s ease-in-out;
  }
  .accordion-toggle.active .icon { transform: rotate(180deg); }
  .accordion-content {
      max-height: 0;
      overflow: hidden;
      transition: max-height 0.5s ease-in-out;
      padding: 0 0.5rem;
  }
  .accordion-content.open { max-height: 2000px; /* Large enough to fit content */ }
  .accordion-content h3 { font-size: 1.1rem; margin-top: 1rem; margin-bottom: 0.5rem; color: var(--primary-text-color); }
  .accordion-content p, .accordion-content li { color: var(--secondary-text-color); margin-bottom: 0.5rem; }
  .accordion-content ol, .accordion-content ul { padding-left: 1.5rem; }
  .accordion-content strong { color: var(--primary-text-color); font-weight: 600; }
  .accordion-content .holiday-list {
      list-style: none;
      padding: 0;
      margin: 0 0 1rem 0;
  }
   .accordion-content .holiday-list li {
       padding: 0.75rem 0.25rem;
       border-bottom: 1px solid #e9e9e7;
       display: flex;
       justify-content: space-between;
       align-items: center;
       gap: 1rem;
       cursor: pointer;
       transition: background-color 0.2s ease;
   }
   .accordion-content .holiday-list li:hover {
       background-color: #f9f9f7;
   }
   .accordion-content .holiday-list li:last-child {
       border-bottom: none;
   }
   .holiday-name {
       display: flex;
       align-items: center;
       gap: 0.75rem;
   }
   .holiday-dot {
       width: 10px;
       height: 10px;
       border-radius: 50%;
       flex-shrink: 0;
   }
   .dot-us { background-color: #0A84FF; }
   
   .view-more-toggle {
       background: none;
       border: none;
       color: var(--accent-color-start);
       font-weight: 600;
       cursor: pointer;
       padding: 0.5rem 0;
       margin-top: 0.5rem;
       display: flex;
       align-items: center;
       gap: 0.5rem;
   }
   .view-more-toggle .icon {
       transition: transform 0.3s ease;
   }
   .rest-of-year-holidays {
       max-height: 0;
       overflow: hidden;
       transition: max-height 0.4s ease-in-out;
   }
  
  /* --- HOLIDAY MODAL --- */
  .modal-overlay {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      background: rgba(0,0,0,0.5);
      backdrop-filter: blur(5px);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      opacity: 0;
      pointer-events: none;
      transition: opacity 0.3s ease;
  }
  .modal-overlay.visible {
      opacity: 1;
      pointer-events: auto;
  }
  .modal-card {
      background: var(--card-bg-color);
      border-radius: 24px;
      padding: 2rem;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 20px 40px rgba(0,0,0,0.2);
      transform: scale(0.95);
      transition: transform 0.3s ease;
  }
  .modal-overlay.visible .modal-card {
      transform: scale(1);
  }
  #modalTitle {
      font-size: 1.75rem;
      margin: 0 0 0.5rem;
      color: var(--primary-text-color);
  }
  #modalHistory {
      color: var(--secondary-text-color);
      margin-bottom: 1.5rem;
      line-height: 1.7;
  }
  #modalFacts h4 {
      font-size: 1.1rem;
      margin-bottom: 0.75rem;
      color: var(--primary-text-color);
      border-bottom: 1px solid var(--border-color);
      padding-bottom: 0.5rem;
  }
  #modalFacts ul {
      list-style: none;
      padding-left: 0;
  }
  #modalFacts li {
      padding-left: 1.5rem;
      position: relative;
      margin-bottom: 0.75rem;
  }
  #modalFacts li::before {
      content: '★';
      color: var(--accent-color-start);
      position: absolute;
      left: 0;
      top: 2px;
  }


  @media (max-width:800px){
    .two,.three{grid-template-columns:1fr}
    h1{ font-size: 24px; min-height: 60px; }
    .card.screen.hidden { width: calc(100% - 36px * 2); }
    .header-info { justify-content: center; text-align: center; }
    .live-clock { text-align: center; }
  }
</style>
</head>
<body>
<div id="particles-js"></div>
<div class="wrap">
  <svg width="0" height="0" style="display:none">
    <symbol id="icon-ok" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M20 6 9 17l-5-5"/></symbol>
    <symbol id="icon-warn" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m21.73 18-8-14a2 2 0 0 0-3.46 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><path d="M12 9v4"/><path d="M12 17h.01"/></symbol>
    <symbol id="icon-err" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><path d="m15 9-6 6"/><path d="m9 9 6 6"/></symbol>
    <symbol id="icon-phone" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></symbol>
    <symbol id="icon-points" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="m12.38 3.49-2.7-2.7a1 1 0 0 0-1.4 0l-6 6a1 1 0 0 0 0 1.4l2.7 2.7c.4.4 1 .4 1.4 0L12.38 5a1 1 0 0 0 0-1.51Z"/><path d="m11.66 7.22-8.43 8.43a1 1 0 0 0 0 1.4l2.7 2.7a1 1 0 0 0 1.4 0l8.43-8.43c.4-.4.4-1 0-1.4L13.06 7.22c-.4-.4-1-.4-1.4 0Z"/><path d="m18 12.5-5-5"/><path d="m12.5 18-5-5"/><circle cx="7.5" cy="16.5" r=".5" fill="currentColor"/><circle cx="16.5" cy="7.5" r=".5" fill="currentColor"/></symbol>
    <symbol id="icon-visits" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M8 2v4"/><path d="M16 2v4"/><rect width="18" height="18" x="3" y="4" rx="2"/><path d="M3 10h18"/><path d="m9 16 2 2 4-4"/></symbol>
  </svg>
  
  <div class="header-info">
      <div id="weatherWidget" class="weather-widget">
          <i class="fas fa-spinner fa-spin"></i> Loading weather...
      </div>
      <div id="liveClock" class="live-clock"></div>
  </div>

  <div class="screens-container" style="position: relative;">
    <div class="card screen" id="lookupCard" aria-live="polite">
      <div class="loading" id="loadingA" hidden>
        <div class="spinner" aria-hidden="true"></div><div>Working…</div>
      </div>
      <h1>Hamilton Deli & Grill — Cashier</h1>
      <div class="sub">Lookup customer, log purchase, apply rewards.</div>

      <div id="bannerA" class="banner"></div>

      <div class="grid two">
        <div class="field">
          <label for="phone">Customer phone *</label>
          <input id="phone" type="tel" inputmode="tel" placeholder="(555) 123-4567" autocomplete="tel" />
        </div>
        <div class="field" style="justify-content: flex-end;">
          <button class="primary" id="btnLookup">Lookup / Start Visit</button>
        </div>
      </div>

      <div id="enrollBox" style="display:none;margin-top:20px">
        <div class="banner warn" style="display:flex">
            <svg class="icon"><use href="#icon-warn" /></svg>
            <span>Customer not enrolled.</span>
        </div>
        <div class="grid two">
          <div>
            <div class="hint">Ask customer to scan to enroll once.</div>
            <div class="tiles" style="margin-top:8px">
              <a class="tile" id="signupLink" target="_blank" rel="noopener">Open Sign-up</a>
              <button class="tile" id="btnShowQR" type="button">Show QR</button>
            </div>
          </div>
          <div id="qrBox" style="display:none">
            <img id="qrImg" alt="Sign-up QR" style="max-width:180px;border-radius:12px;border:1px solid var(--border-color)"/>
          </div>
        </div>
      </div>
    </div>

    <div class="card screen hidden" id="logCard" style="display:none" aria-live="polite">
      <div class="loading" id="loadingB" hidden><div class="spinner"></div><div>Finalizing…</div></div>
      <div id="bannerB" class="banner"></div>

      <div>
          <h2 id="custName">Customer</h2>
          <div class="kpi">
            <span class="chip" id="chipPhone"><svg class="icon"><use href="#icon-phone" /></svg>Phone</span>
            <span class="chip" id="chipPoints"><svg class="icon"><use href="#icon-points" /></svg>Points: 0</span>
            <span class="chip" id="chipVisits"><svg class="icon"><use href="#icon-visits" /></svg>Visits: 0</span>
            <span class="chip" id="chipNext">Next reward in —</span>
            <span class="chip badge" id="chipEligible" style="display:none">Eligible: Free drink</span>
          </div>
      </div>
      
      <div class="summary" style="margin-top: 24px;">
        <div class="row"><div>Subtotal</div><div class="right big" id="sumSubtotal">$0.00</div></div>
        <div class="row"><div class="muted">Reward</div><div class="right" id="sumReward">—</div></div>
        <div class="row"><div class="muted">Review bonus</div><div class="right" id="sumReview">—</div></div>
        <div class="row"><div class="muted">Points discount</div><div class="right" id="sumPts">$0.00</div></div>
        <hr>
        <div class="row"><div class="big">Net to charge</div><div class="right big" id="sumNet">$0.00</div></div>
      </div>

      <div class="field" style="margin-top: 24px;">
        <label for="orderTotal">Order total ($) *</label>
        <input id="orderTotal" type="number" min="0" step="0.01" placeholder="0.00" />
        <div class="hint" id="pointsHint">Points this visit: 0</div>
      </div>
      
      <div class="field" style="gap: 12px; margin-top: 18px;">
        <label class="styled-checkbox-wrap" id="reviewWrap">
            <input type="checkbox" id="reviewVerified">
            <span class="checkmark"></span>
            <span>Review verified in-store (-$5 bonus)</span>
        </label>
        <label class="styled-checkbox-wrap" id="applyWrap">
            <input type="checkbox" id="applyReward" disabled>
            <span class="checkmark"></span>
            <span>Apply free Coffee/20oz drink now</span>
        </label>
      </div>

      <div class="grid two" style="margin-top: 18px;">
        <div class="field">
          <label for="redeemPts">Redeem points</label>
          <input id="redeemPts" type="number" min="0" step="1" placeholder="0" />
          <div class="hint" id="redeemHint">Available: 0 · $0.00 value (100 pts = $5)</div>
        </div>
        <div class="field" style="justify-content: flex-end;">
          <button class="ghost" id="btnMaxRedeem" type="button">Redeem Max</button>
        </div>
      </div>

      <div class="field" style="margin-top:16px">
        <label>Categories in this order</label>
        <div class="tiles" id="catTiles"></div>
        <div class="hint">Tap all that apply.</div>
      </div>

      <div class="actions">
        <button class="primary" id="btnFinalize">Finalize visit</button>
        <button class="ghost" id="btnBack">Start next customer</button>
      </div>
    </div>

    <div class="card screen hidden" id="doneCard" style="display:none" aria-live="polite">
      <div class="banner ok" style="display:flex" id="doneMsg">
        <svg class="icon"><use href="#icon-ok" /></svg>
        <span>Visit logged.</span>
      </div>
      <div class="summary">
        <div class="row"><div>Subtotal</div><div class="right" id="doneSubtotal">$0.00</div></div>
        <div class="row"><div>Reward</div><div class="right" id="doneReward">—</div></div>
        <div class="row"><div>Review bonus</div><div class="right" id="doneReview">—</div></div>
        <div class="row"><div>Points discount</div><div class="right" id="donePts">$0.00</div></div>
        <hr>
        <div class="row"><div class="big">Net</div><div class="right big" id="doneNet">$0.00</div></div>
      </div>
      <div class="actions"><button class="primary" id="btnReset">Start next customer</button></div>
    </div>
  </div>
  
  <div class="card accordion-card">
    <button class="accordion-toggle" id="holidayToggle">
        <h2><i class="fas fa-calendar-alt"></i> Upcoming Holidays</h2>
        <i class="fas fa-chevron-down icon"></i>
    </button>
    <div class="accordion-content" id="holidayContent">
        <h3>Next 30 Days</h3>
        <ul class="holiday-list" id="nextMonthHolidayList"><li>No holidays in the next 30 days.</li></ul>
        
        <button class="view-more-toggle" id="viewMoreHolidays">
            <span>View Next 3 Months</span>
            <i class="fas fa-chevron-down icon"></i>
        </button>
        
        <div class="rest-of-year-holidays" id="restOfYearHolidays">
             <ul class="holiday-list" id="restOfYearHolidayList"></ul>
        </div>
    </div>
  </div>

  <div class="card accordion-card">
    <button class="accordion-toggle" id="sopToggle">
        <h2><i class="fas fa-book-open"></i> Cashier Quick Guide (SOP)</h2>
        <i class="fas fa-chevron-down icon"></i>
    </button>
    <div class="accordion-content" id="sopContent">
        <h3>Procedure 1: First-Time Customer</h3>
        <ol>
            <li><strong>Initial Lookup:</strong> Greet customer and enter their 10-digit phone number. Press "Lookup / Start Visit".</li>
            <li><strong>New Member Signup:</strong> If the app shows "Customer not enrolled," direct them to the QR code to sign up. Remind them about earning points and the $5 review bonus.</li>
            <li><strong>Complete First Transaction:</strong> After they sign up, look up their number again. Proceed to the returning customer steps below.</li>
        </ol>

        <h3>Procedure 2: Returning Customer</h3>
        <ol>
            <li><strong>Member Lookup:</strong> Enter their 10-digit phone number and press "Lookup". The app will load their profile.</li>
            <li><strong>Enter Order & Apply Rewards:</strong>
                <ul>
                    <li>Enter the pre-tax order total in the "Order total ($)" field.</li>
                    <li><strong>Redeeming Points:</strong> Ask if they want to use their available points for a discount. Enter the amount or press "Redeem Max".</li>
                    <li><strong>Review Bonus:</strong> If the "Review verified" checkbox is active, ask if they've left a review. If they show you, check the box to apply a $5 discount.</li>
                    <li><strong>Order Categories:</strong> Tap all categories that apply to their purchase.</li>
                </ul>
            </li>
            <li><strong>Finalize Visit:</strong> Confirm the final "Net to charge" with the customer, then press "Finalize visit". Press "Start next customer" to reset.</li>
        </ol>

        <h3>Points System Rules</h3>
        <ul>
            <li><strong>Earning:</strong> 1 point per $1 spent (pre-tax).</li>
            <li><strong>Redeeming:</strong> 100 points = $5.00 discount.</li>
            <li>Points have no cash value and terms can be modified.</li>
        </ul>

        <h3>Frequently Asked Questions (FAQ)</h3>
        <p><strong>What if the "Finalize visit" button is disabled?</strong><br>
        The customer has already checked in today. Only one visit per day is allowed.</p>
        <p><strong>Do points expire?</strong><br>
        No, points do not expire.</p>
       <p><strong>Customer wants to update their info?</strong><br>
        They need to sign up again. For issues, text (609)-529-0509.</p>
    </div>
  </div>

</div>

<div class="modal-overlay" id="holidayModal">
    <div class="modal-card">
        <h3 id="modalTitle">Holiday Name</h3>
        <p id="modalHistory">A brief history of the holiday.</p>
        <div id="modalFacts">
            <h4>Fun Facts</h4>
            <ul>
                <li>Fact 1</li>
                <li>Fact 2</li>
                <li>Fact 3</li>
            </ul>
        </div>
        <div class="actions" style="justify-content: flex-end;">
            <button class="ghost" id="modalClose">Close</button>
        </div>
    </div>
</div>


<script src="https://cdn.jsdelivr.net/particles.js/2.0.0/particles.min.js"></script>
<script>
/* ===================== CONFIG (FROM WORKING VERSION) ===================== */
const WEBHOOK_LOOKUP  = 'https://princetonai.app.n8n.cloud/webhook/cashier/lookup';
const WEBHOOK_FINALIZE= 'https://princetonai.app.n8n.cloud/webhook/cashier/finalize';

const STORE_ID    = 'hamilton-main';  // optional, sent to n8n
const CASHIER_ID = 'register-1';     // optional, sent to n8n

const SIGNUP_URL = 'https://princetonaipartners.github.io/concierge/signup/';
/* ======================================================================== */

const CATEGORIES = ['Grocery','Convenience','Coffee','Deli/food','Krispy Chicken','Other'];
const REWARD_CYCLE = 5;
const DOLLARS_PER_POINT = 0.05; // 100 points = $5

const $ = q => document.querySelector(q);
const money = v => (Number.isFinite(+v) ? (+v).toLocaleString(undefined,{style:'currency',currency:'USD'}) : '$0.00');
const clamp  = (v,min,max)=> Math.min(max, Math.max(min, v));
const clamp0 = v => Math.max(0, v||0);
const digits10 = v => {
  const d = String(v||'').replace(/\D/g,'');
  return d.length >= 10 ? d.slice(-10) : null;
};

let state = {
  visitId: null,
  phone10: null,
  customer: null,       // from lookup
  eligibleNow: false, // apply free drink now (disabled for lookup flow)
  alreadyToday: false,
  smsOptin: false,
  points: 0,            // current balance
  reviewEligible: false, // can use $5 review bonus
  redeemPts: 0,
};

function setBanner(elId, kind, text){
  const el = $(elId);
  const icons = {'ok': '#icon-ok', 'warn': '#icon-warn', 'err': '#icon-err'};
  const iconHtml = kind && icons[kind] ? `<svg class="icon"><use href="${icons[kind]}" /></svg>` : '';
  el.className = `banner ${kind}`;
  el.innerHTML = text ? `${iconHtml}<span>${text}</span>` : '';
  el.style.display = text ? 'flex' : 'none';
}
function setLoading(id, on){ $(id).hidden = !on; }

function buildTiles(){
  const box = $('#catTiles'); box.innerHTML = '';
  CATEGORIES.forEach(name=>{
    const div = document.createElement('div');
    div.className = 'tile'; div.textContent = name;
    div.addEventListener('click', ()=>{ div.classList.toggle('sel'); recompute(); });
    box.appendChild(div);
  });
}
function selectedCats(){
  return [...document.querySelectorAll('#catTiles .tile.sel')].map(el=>el.textContent);
}

function maxRedeemPtsGivenSubtotal(subtotal, reviewUsed){
  const maxDollarsFromPts = clamp0(subtotal - (reviewUsed ? 5 : 0));
  return Math.floor(maxDollarsFromPts / DOLLARS_PER_POINT);
}

// Helper to flash an element when its value updates
function flashUpdate(el) {
    el.classList.add('updated');
    el.addEventListener('animationend', () => {
        el.classList.remove('updated');
    }, { once: true });
}

function recompute(){
  const subtotal = Number($('#orderTotal').value || 0);
  const reviewUsed = $('#reviewVerified').checked ? 5 : 0;

  const maxPtsBySubtotal = maxRedeemPtsGivenSubtotal(subtotal, !!reviewUsed);
  const desiredPts = Number($('#redeemPts').value || 0);
  const cap = Math.min(state.points, maxPtsBySubtotal);
  state.redeemPts = clamp(desiredPts, 0, cap);
  if (desiredPts !== state.redeemPts) $('#redeemPts').value = state.redeemPts;

  const ptsDollars = state.redeemPts * DOLLARS_PER_POINT;

  const apply = $('#applyReward').checked && state.eligibleNow ? 'FREE Coffee or 20 oz Drink' : '';
  const rewardDiscount = 0;
  const net = clamp0(subtotal - reviewUsed - rewardDiscount - ptsDollars);

  // Update text content
  $('#pointsHint').textContent = `Points this visit: ${Math.max(0, Math.floor(subtotal))}`;
  
  if ($('#sumSubtotal').textContent !== money(subtotal)) {
    $('#sumSubtotal').textContent = money(subtotal);
    flashUpdate($('#sumSubtotal'));
  }
  if ($('#sumReward').textContent !== (apply || '—')) {
    $('#sumReward').textContent = apply || '—';
    flashUpdate($('#sumReward'));
  }
  if ($('#sumReview').textContent !== (reviewUsed ? ('-$'+reviewUsed.toFixed(2)) : '—')) {
    $('#sumReview').textContent = reviewUsed ? ('-$'+reviewUsed.toFixed(2)) : '—';
    flashUpdate($('#sumReview'));
  }
  if ($('#sumPts').textContent !== (ptsDollars ? ('-'+money(ptsDollars)) : '$0.00')) {
    $('#sumPts').textContent = ptsDollars ? ('-'+money(ptsDollars)) : '$0.00';
    flashUpdate($('#sumPts'));
  }
  if ($('#sumNet').textContent !== money(net)) {
    $('#sumNet').textContent = money(net);
    flashUpdate($('#sumNet'));
  }

  const remaining = state.points - state.redeemPts;
  $('#redeemHint').textContent = `Available: ${state.points} · Using ${state.redeemPts} (left ${remaining}) · ${money(state.redeemPts*DOLLARS_PER_POINT)} value (100 pts = $5)`;
  
  $('#applyWrap').dataset.disabled = $('#applyReward').disabled;
  $('#reviewWrap').dataset.disabled = $('#reviewVerified').disabled;
}

const ALL_SCREENS = ['lookupCard', 'logCard', 'doneCard'];
function showScreen(screenId) {
    ALL_SCREENS.forEach(id => {
        const el = $(`#${id}`);
        if (id === screenId) {
            el.style.display = 'block';
            requestAnimationFrame(() => { el.classList.remove('hidden'); });
        } else {
            el.classList.add('hidden');
            el.addEventListener('transitionend', () => {
                if (el.classList.contains('hidden')) el.style.display = 'none';
            }, { once: true });
        }
    });
}

function resetAll(){
  state = { visitId:null, phone10:null, customer:null, eligibleNow:false, alreadyToday:false, smsOptin:false, points:0, reviewEligible:false, redeemPts:0 };
  $('#phone').value='';
  setBanner('#bannerA','',''); setBanner('#bannerB','','');
  $('#enrollBox').style.display='none'; $('#qrBox').style.display='none';
  $('#orderTotal').value='';
  $('#reviewVerified').checked=false;
  $('#applyReward').checked=false;
  $('#applyReward').disabled=true;
  $('#redeemPts').value='0';
  [...document.querySelectorAll('#catTiles .tile')].forEach(el=>el.classList.remove('sel'));
  recompute();
  showScreen('lookupCard');
}

function updateClock() {
    const now = new Date();
    const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric', hour: 'numeric', minute: '2-digit', second: '2-digit' };
    $('#liveClock').textContent = now.toLocaleDateString('en-US', options);
}

// Initial setup
buildTiles();
resetAll();
updateClock();
setInterval(updateClock, 1000);


/* ---------- Lookup ---------- */
$('#btnLookup').addEventListener('click', async ()=>{
  setBanner('#bannerA','','');
  const phone10 = digits10($('#phone').value);
  if (!phone10){ setBanner('#bannerA','warn','Enter a valid phone number.'); return; }

  setLoading('#loadingA', true);
  try{
    const r = await fetch(WEBHOOK_LOOKUP + `?t=${Date.now()}`, {
      method:'POST',
      headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ phone: phone10, storeId: STORE_ID, cashierId: CASHIER_ID })
    });
    if(!r.ok) throw new Error(`HTTP ${r.status}`);
    const res = await r.json();

    if (!res.hasAccount){
      $('#enrollBox').style.display='block';
      $('#signupLink').href = SIGNUP_URL;
      $('#qrImg').src = `https://chart.googleapis.com/chart?cht=qr&chs=220x220&chl=${encodeURIComponent(SIGNUP_URL)}`;
      setBanner('#bannerA','warn', res.message || 'Not enrolled. Ask customer to sign up once.');
      return;
    }

    state.phone10        = phone10;
    state.customer       = res;
    state.alreadyToday   = !!res.alreadyToday;
    state.smsOptin       = !!res.smsOptin;
    state.points         = Number(res.points ?? 0);
    state.reviewEligible = !!res.reviewBonusAvailable;
    state.redeemPts      = 0;
    const willUnlockOnFinalize = !!res.willUnlockOnFinalize;
    state.eligibleNow = false;
    $('#applyReward').checked = false;
    $('#applyReward').disabled = true;

    const name = res.customerName || 'Customer';
    $('#custName').textContent = name;
    $('#chipPhone').innerHTML = `<svg class="icon"><use href="#icon-phone" /></svg> (${phone10.slice(0,3)}) ${phone10.slice(3,6)}-${phone10.slice(6)}`;
    $('#chipPoints').innerHTML = `<svg class="icon"><use href="#icon-points" /></svg> Points: ${state.points}`;
    $('#chipVisits').innerHTML = `<svg class="icon"><use href="#icon-visits" /></svg> Visits: ${Number(res.totalVisits ?? 0)}`;
    const vtn = res.visitsToNextReward;
    $('#chipNext').textContent = Number.isFinite(vtn) ? `Next reward in ${vtn} visit(s)` : 'Next reward —';

    const badge = $('#chipEligible');
    if (willUnlockOnFinalize) {
      badge.style.display = 'inline-flex';
      badge.textContent = 'Unlocks on finalize';
    } else { badge.style.display = 'none'; }

    $('#reviewVerified').disabled = !state.reviewEligible;
    $('#reviewVerified').checked  = false;
    setBanner('#bannerB','','');
    if (!state.alreadyToday) {
      if (!state.reviewEligible) {
        setBanner('#bannerB','warn','Review bonus already used on this account.');
      } else {
        setBanner('#bannerB','ok', `Welcome back${name ? ', ' + name : ''}!`);
      }
    }
    
    $('#redeemPts').value = '0';
    $('#btnFinalize').disabled = !!state.alreadyToday;
    if (state.alreadyToday){
      setBanner('#bannerB','warn','Already checked in today — finalize disabled.');
    }
    
    showScreen('logCard');
    $('#enrollBox').style.display='none';
    recompute();
    setTimeout(() => $('#orderTotal').focus(), 400);
  }catch(e){
    console.error(e);
    setBanner('#bannerA','err','Lookup failed. Check network.');
  }finally{
    setLoading('#loadingA', false);
  }
});

$('#btnShowQR').addEventListener('click', ()=>{
  $('#qrBox').style.display = $('#qrBox').style.display==='none' ? 'block' : 'none';
});

/* ---------- Live recompute on changes ---------- */
$('#orderTotal').addEventListener('input', recompute);
$('#reviewVerified').addEventListener('change', recompute);
$('#applyReward').addEventListener('change', recompute);
$('#redeemPts').addEventListener('input', recompute);

function animateCount(el, start, end, duration) {
    if (start === end) { recompute(); return; }
    let startTime = null;
    const animation = currentTime => {
        if (!startTime) startTime = currentTime;
        const progress = Math.min((currentTime - startTime) / duration, 1);
        el.value = Math.floor(progress * (end - start) + start);
        if (progress < 1) {
            requestAnimationFrame(animation);
        } else {
            el.value = end;
            recompute();
        }
    };
    requestAnimationFrame(animation);
}

$('#btnMaxRedeem').addEventListener('click', ()=>{
  const subtotal = Number($('#orderTotal').value || 0);
  const maxBySubtotal = maxRedeemPtsGivenSubtotal(subtotal, $('#reviewVerified').checked);
  const cap = Math.min(state.points, maxBySubtotal);
  const startVal = Number($('#redeemPts').value) || 0;
  animateCount($('#redeemPts'), startVal, cap, 300);
});

/* ---------- Finalize ---------- */
$('#btnFinalize').addEventListener('click', async ()=>{
  const phone10 = state.phone10;
  const subtotal = Number($('#orderTotal').value || 0);
  if (!phone10){ setBanner('#bannerB','warn','Missing phone.'); return; }
  if (!(subtotal >= 0)){ setBanner('#bannerB','warn','Enter a valid order total.'); return; }
  if (state.alreadyToday){ setBanner('#bannerB','warn','Already checked in today.'); return; }

  state.visitId = `${Date.now()}-${Math.random().toString(36).slice(2,10)}`;

  const payload = {
    visitId: state.visitId,
    phone: phone10,
    orderTotal: subtotal,
    categories: selectedCats(),
    reviewVerified: !!$('#reviewVerified').checked,
    redeemPoints: Number(state.redeemPts || 0),
    applyRewards: ($('#applyReward').checked && state.eligibleNow) ? ['FIFTH_VISIT_FREE_DRINK'] : [],
    storeId: STORE_ID,
    cashierId: CASHIER_ID,
  };

  setLoading('#loadingB', true);
  try{
    const r = await fetch(WEBHOOK_FINALIZE, {
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify(payload)
    });
    if(!r.ok) throw new Error(`HTTP ${r.status}`);
    const res = await r.json();

    const usedPtsDollars = (res.pointsRedeemed ?? state.redeemPts) * DOLLARS_PER_POINT;
    $('#doneSubtotal').textContent = money(res.orderTotal ?? subtotal);
    $('#doneReward').textContent   = res.rewardLabel || (payload.applyRewards.length ? 'FREE Coffee or 20 oz Drink' : '—');
    $('#doneReview').textContent   = (res.reviewBonus ? '-$'+Number(res.reviewBonus).toFixed(2) : '—');
    $('#donePts').textContent      = usedPtsDollars ? ('-'+money(usedPtsDollars)) : '$0.00';
    $('#doneNet').textContent      = money(res.netCharge ?? Math.max(0, subtotal - (res.reviewBonus||0) - usedPtsDollars));
    $('#doneMsg').innerHTML = `<svg class="icon"><use href="#icon-ok" /></svg><span>${res.message || 'Visit logged. SMS will be sent if opted-in.'}</span>`;
    showScreen('doneCard');
  }catch(e){
    console.error(e);
    setBanner('#bannerB','err','Finalize failed. Please retry.');
  }finally{
    setLoading('#loadingB', false);
  }
});

/* ---------- Back / Reset ---------- */
$('#btnBack').addEventListener('click', resetAll);
$('#btnReset').addEventListener('click', resetAll);

/* ======================================================================== */
/* ---------- NEW UI FEATURES (from new version) ---------- */
/* ======================================================================== */

document.addEventListener('DOMContentLoaded', () => {
    // Title Animation
    const title = document.querySelector('h1');
    const text = title.textContent;
    title.innerHTML = ''; // Clear original text
    text.split('').forEach((char, index) => {
        const span = document.createElement('span');
        span.className = 'char';
        span.textContent = char === ' ' ? '\u00A0' : char; // Use non-breaking space
        span.style.animationDelay = `${index * 0.03}s`;
        title.appendChild(span);
    });

    // Accordion Toggles
    document.querySelectorAll('.accordion-toggle').forEach(toggle => {
        toggle.addEventListener('click', () => {
            toggle.classList.toggle('active');
            const content = toggle.nextElementSibling;
            if (content.style.maxHeight) {
                content.style.maxHeight = null;
            } else {
                content.style.maxHeight = content.scrollHeight + "px";
            }
        });
    });
    
    // Particles JS
    particlesJS('particles-js', {
        "particles": {
            "number": { "value": 60, "density": { "enable": true, "value_area": 800 } },
            "color": { "value": "#0A84FF" },
            "shape": { "type": "circle" },
            "opacity": { "value": 0.4, "random": true },
            "size": { "value": 3, "random": true },
            "line_linked": { "enable": false },
            "move": { "enable": true, "speed": 1, "direction": "none", "random": true, "straight": false, "out_mode": "out", "bounce": false }
        },
        "interactivity": { "detect_on": "canvas", "events": { "onhover": { "enable": false }, "onclick": { "enable": false }, "resize": true } },
        "retina_detect": true
    });
    
    // --- Weather Widget ---
    const fetchWeather = async () => {
        const apiKey = 'd8f28cb492b455f53e6d203679f2252a'; 
        const lat = 40.2222; // Latitude for Hamilton, NJ
        const lon = -74.6868; // Longitude for Hamilton, NJ
        const url = `https://api.openweathermap.org/data/2.5/weather?lat=${lat}&lon=${lon}&appid=${apiKey}&units=imperial`;
        const widget = $('#weatherWidget');

        try {
            const response = await fetch(url);
            if (!response.ok) throw new Error('Weather data not available.');
            const data = await response.json();

            const temp = Math.round(data.main.temp);
            const description = data.weather[0].description.replace(/\b\w/g, l => l.toUpperCase()); // Capitalize words
            const iconCode = data.weather[0].icon;
            
            const iconMap = {
                '01d': 'fa-sun', '01n': 'fa-moon', '02d': 'fa-cloud-sun', '02n': 'fa-cloud-moon',
                '03d': 'fa-cloud', '03n': 'fa-cloud', '04d': 'fa-cloud', '04n': 'fa-cloud',
                '09d': 'fa-cloud-showers-heavy', '09n': 'fa-cloud-showers-heavy', '10d': 'fa-cloud-sun-rain', '10n': 'fa-cloud-moon-rain',
                '11d': 'fa-cloud-bolt', '11n': 'fa-cloud-bolt', '13d': 'fa-snowflake', '13n': 'fa-snowflake',
                '50d': 'fa-smog', '50n': 'fa-smog',
            };
            const iconClass = iconMap[iconCode] || 'fa-question-circle';

            widget.innerHTML = `<i class="fas ${iconClass}"></i> ${temp}°F, ${description}`;
        } catch (error) {
            console.error("Weather fetch error:", error);
            widget.textContent = 'Weather Unavailable';
        }
    }
    
    // --- Holiday Widget ---
    const initHolidayWidget = () => {
        const holidays = [
             // 2024
            { date: '2024-10-14', name: 'Columbus Day', type: 'us', history: 'Commemorates Christopher Columbus\'s arrival in the Americas in 1492. It became a federal holiday in 1937.', facts: ['Many cities and states celebrate Indigenous Peoples\' Day instead.', 'It is celebrated in other countries as "Día de la Raza".', 'The first celebration was in 1792, 300 years after his arrival.'] },
            { date: '2024-10-31', name: 'Halloween', type: 'us', history: 'Originating from the ancient Celtic festival of Samhain, people would light bonfires and wear costumes to ward off ghosts.', facts: ['The term "trick-or-treat" dates back to the early 20th century.', 'The largest pumpkin ever recorded weighed over 2,600 pounds.', 'Scotland and Ireland still practice many ancient Halloween traditions.'] },
            { date: '2024-11-11', name: 'Veterans Day', type: 'us', history: 'Originally called "Armistice Day" to mark the end of World War I, it was changed to Veterans Day in 1954 to honor all veterans.', facts: ['It is a federal holiday and a state holiday in all states.', 'It is always observed on November 11th, regardless of the day of the week.', 'Other countries celebrate a similar holiday, like Remembrance Day.'] },
            { date: '2024-11-28', name: 'Thanksgiving', type: 'us', history: 'Celebrates the harvest feast shared by the Pilgrims and the Wampanoag people in 1621. Abraham Lincoln declared it a national holiday in 1863.', facts: ['The first Macy\'s Thanksgiving Day Parade featured live animals from the Central Park Zoo.', 'About 46 million turkeys are eaten on Thanksgiving each year.', 'The tradition of "pardoning" a turkey began with President George H.W. Bush in 1989.'] },
            { date: '2024-12-25', name: 'Christmas Day', type: 'us', history: 'A Christian holiday celebrating the birth of Jesus Christ. Many of its traditions, like Christmas trees, have pre-Christian origins.', facts: ['The song "Jingle Bells" was originally written for Thanksgiving.', 'Alabama was the first state to officially recognize Christmas in 1836.', 'The image of Santa Claus was popularized by a Coca-Cola advertising campaign in the 1930s.'] },
            // 2025
            { date: '2025-01-01', name: 'New Year\'s Day', type: 'us', history: 'The earliest recorded New Year\'s celebration dates back to ancient Babylon. It marks the start of a new year on the Gregorian calendar.', facts: ['The Times Square ball drop has been a tradition since 1907.', 'Eating black-eyed peas on New Year\'s is thought to bring good luck.', 'Many people make "New Year\'s resolutions" to improve themselves.'] },
            { date: '2025-01-20', name: 'MLK Jr. Day', type: 'us', history: 'Honors the life and legacy of civil rights leader Martin Luther King Jr. It was signed into law in 1983 and first observed in 1986.', facts: ['It is a day of national service, often referred to as a "day on, not a day off".', 'The holiday is observed on the third Monday of January.', 'Stevie Wonder\'s song "Happy Birthday" was instrumental in the campaign for the holiday.'] },
            { date: '2025-02-14', name: 'Valentine\'s Day', type: 'us', history: 'Named after St. Valentine, a Roman priest. It evolved into a day of romance from the 14th century onwards.', facts: ['Over 1 billion Valentine\'s Day cards are sent each year.', 'Richard Cadbury produced the first box of chocolates for this holiday in the late 1800s.', 'The phrase "wearing your heart on your sleeve" has medieval origins.'] },
            { date: '2025-02-17', name: 'Presidents\' Day', type: 'us', history: 'Originally established to celebrate George Washington\'s birthday. It was moved to the third Monday in February and now honors all U.S. presidents.', facts: ['It never falls on the actual birthday of any American president.', 'It\'s a popular day for car and mattress sales.', 'The official name is still "Washington\'s Birthday" for federal purposes.'] },
            { date: '2025-03-17', name: 'St. Patrick\'s Day', type: 'us', history: 'A cultural and religious holiday celebrating the patron saint of Ireland. It became a public celebration in the United States in the 18th century.', facts: ['The Chicago River is dyed green every year for the celebration.', 'The original color associated with St. Patrick was blue.', 'The world\'s shortest St. Patrick\'s Day parade is in Hot Springs, Arkansas.'] },
            { date: '2025-04-20', name: 'Easter Sunday', type: 'us', history: 'The most important Christian festival, celebrating the resurrection of Jesus Christ. The tradition of Easter eggs symbolizes new life.', facts: ['Americans spend over $2 billion on Easter candy.', 'The White House Easter Egg Roll tradition was started by President Rutherford B. Hayes.', 'The idea of the Easter Bunny originated in Germany.'] },
            { date: '2025-05-26', name: 'Memorial Day', type: 'us', history: 'Originally known as Decoration Day, it originated after the Civil War to commemorate fallen soldiers. It became a federal holiday in 1971.', facts: ['It is traditionally seen as the unofficial start of summer.', 'The "National Moment of Remembrance" occurs at 3 p.m. local time.', 'Many people wear a red poppy in remembrance of those who died in war.'] },
            { date: '2025-06-19', name: 'Juneteenth', type: 'us', history: 'Commemorates the end of slavery in the United States. It marks the day in 1865 when Union soldiers announced freedom to enslaved African Americans in Texas.', facts: ['It became a federal holiday in 2021.', 'The name is a combination of "June" and "nineteenth".', 'Common celebrations include barbecues, parades, and historical reenactments.'] },
            { date: '2025-07-04', name: 'Independence Day', type: 'us', history: 'Celebrates the adoption of the Declaration of Independence on July 4, 1776, when the United States officially separated from Great Britain.', facts: ['Three U.S. presidents have died on July 4th: John Adams, Thomas Jefferson, and James Monroe.', 'The first fireworks on July 4th were set off in 1777.', 'It is the biggest hot dog holiday of the year.'] },
            { date: '2025-09-01', name: 'Labor Day', type: 'us', history: 'A creation of the labor movement, it is dedicated to the social and economic achievements of American workers. It became a federal holiday in 1894.', facts: ['It is celebrated on the first Monday of September.', 'It is considered the unofficial end of summer.', 'The first Labor Day parade was held in New York City in 1882.'] },
            { date: '2025-10-13', name: 'Columbus Day', type: 'us', history: 'Commemorates Christopher Columbus\'s arrival in the Americas in 1492. It became a federal holiday in 1937.', facts: ['Many cities and states celebrate Indigenous Peoples\' Day instead.', 'It is celebrated in other countries as "Día de la Raza".', 'The first celebration was in 1792, 300 years after his arrival.'] },
            { date: '2025-10-31', name: 'Halloween', type: 'us', history: 'Originating from the ancient Celtic festival of Samhain, people would light bonfires and wear costumes to ward off ghosts.', facts: ['The term "trick-or-treat" dates back to the early 20th century.', 'The largest pumpkin ever recorded weighed over 2,600 pounds.', 'Scotland and Ireland still practice many ancient Halloween traditions.'] },
            { date: '2025-11-11', name: 'Veterans Day', type: 'us', history: 'Originally called "Armistice Day" to mark the end of World War I, it was changed to Veterans Day in 1954 to honor all veterans.', facts: ['It is a federal holiday and a state holiday in all states.', 'It is always observed on November 11th, regardless of the day of the week.', 'Other countries celebrate a similar holiday, like Remembrance Day.'] },
            { date: '2025-11-27', name: 'Thanksgiving', type: 'us', history: 'Celebrates the harvest feast shared by the Pilgrims and the Wampanoag people in 1621. Abraham Lincoln declared it a national holiday in 1863.', facts: ['The first Macy\'s Thanksgiving Day Parade featured live animals from the Central Park Zoo.', 'About 46 million turkeys are eaten on Thanksgiving each year.', 'The tradition of "pardoning" a turkey began with President George H.W. Bush in 1989.'] },
            { date: '2025-12-25', name: 'Christmas Day', type: 'us', history: 'A Christian holiday celebrating the birth of Jesus Christ. Many of its traditions, like Christmas trees, have pre-Christian origins.', facts: ['The song "Jingle Bells" was originally written for Thanksgiving.', 'Alabama was the first state to officially recognize Christmas in 1836.', 'The image of Santa Claus was popularized by a Coca-Cola advertising campaign in the 1930s.'] },
             // 2026
            { date: '2026-01-01', name: 'New Year\'s Day', type: 'us', history: 'The earliest recorded New Year\'s celebration dates back to ancient Babylon. It marks the start of a new year on the Gregorian calendar.', facts: ['The Times Square ball drop has been a tradition since 1907.', 'Eating black-eyed peas on New Year\'s is thought to bring good luck.', 'Many people make "New Year\'s resolutions" to improve themselves.'] },
            { date: '2026-01-19', name: 'MLK Jr. Day', type: 'us', history: 'Honors the life and legacy of civil rights leader Martin Luther King Jr. It was signed into law in 1983 and first observed in 1986.', facts: ['It is a day of national service, often referred to as a "day on, not a day off".', 'The holiday is observed on the third Monday of January.', 'Stevie Wonder\'s song "Happy Birthday" was instrumental in the campaign for the holiday.'] },
            { date: '2026-02-14', name: 'Valentine\'s Day', type: 'us', history: 'Named after St. Valentine, a Roman priest. It evolved into a day of romance from the 14th century onwards.', facts: ['Over 1 billion Valentine\'s Day cards are sent each year.', 'Richard Cadbury produced the first box of chocolates for this holiday in the late 1800s.', 'The phrase "wearing your heart on your sleeve" has medieval origins.'] },
            { date: '2026-02-16', name: 'Presidents\' Day', type: 'us', history: 'Originally established to celebrate George Washington\'s birthday. It was moved to the third Monday in February and now honors all U.S. presidents.', facts: ['It never falls on the actual birthday of any American president.', 'It\'s a popular day for car and mattress sales.', 'The official name is still "Washington\'s Birthday" for federal purposes.'] },
            { date: '2026-03-17', name: 'St. Patrick\'s Day', type: 'us', history: 'A cultural and religious holiday celebrating the patron saint of Ireland. It became a public celebration in the United States in the 18th century.', facts: ['The Chicago River is dyed green every year for the celebration.', 'The original color associated with St. Patrick was blue.', 'The world\'s shortest St. Patrick\'s Day parade is in Hot Springs, Arkansas.'] },
            { date: '2026-04-05', name: 'Easter Sunday', type: 'us', history: 'The most important Christian festival, celebrating the resurrection of Jesus Christ. The tradition of Easter eggs symbolizes new life.', facts: ['Americans spend over $2 billion on Easter candy.', 'The White House Easter Egg Roll tradition was started by President Rutherford B. Hayes.', 'The idea of the Easter Bunny originated in Germany.'] },
            { date: '2026-05-25', name: 'Memorial Day', type: 'us', history: 'Originally known as Decoration Day, it originated after the Civil War to commemorate fallen soldiers. It became a federal holiday in 1971.', facts: ['It is traditionally seen as the unofficial start of summer.', 'The "National Moment of Remembrance" occurs at 3 p.m. local time.', 'Many people wear a red poppy in remembrance of those who died in war.'] },
            { date: '2026-06-19', name: 'Juneteenth', type: 'us', history: 'Commemorates the end of slavery in the United States. It marks the day in 1865 when Union soldiers announced freedom to enslaved African Americans in Texas.', facts: ['It became a federal holiday in 2021.', 'The name is a combination of "June" and "nineteenth".', 'Common celebrations include barbecues, parades, and historical reenactments.'] },
            { date: '2026-07-04', name: 'Independence Day', type: 'us', history: 'Celebrates the adoption of the Declaration of Independence on July 4, 1776, when the United States officially separated from Great Britain.', facts: ['Three U.S. presidents have died on July 4th: John Adams, Thomas Jefferson, and James Monroe.', 'The first fireworks on July 4th were set off in 1777.', 'It is the biggest hot dog holiday of the year.'] },
            { date: '2026-09-07', name: 'Labor Day', type: 'us', history: 'A creation of the labor movement, it is dedicated to the social and economic achievements of American workers. It became a federal holiday in 1894.', facts: ['It is celebrated on the first Monday of September.', 'It is considered the unofficial end of summer.', 'The first Labor Day parade was held in New York City in 1882.'] },
            { date: '2026-10-12', name: 'Columbus Day', type: 'us', history: 'Commemorates Christopher Columbus\'s arrival in the Americas in 1492. It became a federal holiday in 1937.', facts: ['Many cities and states celebrate Indigenous Peoples\' Day instead.', 'It is celebrated in other countries as "Día de la Raza".', 'The first celebration was in 1792, 300 years after his arrival.'] },
            { date: '2026-10-31', name: 'Halloween', type: 'us', history: 'Originating from the ancient Celtic festival of Samhain, people would light bonfires and wear costumes to ward off ghosts.', facts: ['The term "trick-or-treat" dates back to the early 20th century.', 'The largest pumpkin ever recorded weighed over 2,600 pounds.', 'Scotland and Ireland still practice many ancient Halloween traditions.'] },
            { date: '2026-11-11', name: 'Veterans Day', type: 'us', history: 'Originally called "Armistice Day" to mark the end of World War I, it was changed to Veterans Day in 1954 to honor all veterans.', facts: ['It is a federal holiday and a state holiday in all states.', 'It is always observed on November 11th, regardless of the day of the week.', 'Other countries celebrate a similar holiday, like Remembrance Day.'] },
            { date: '2026-11-26', name: 'Thanksgiving', type: 'us', history: 'Celebrates the harvest feast shared by the Pilgrims and the Wampanoag people in 1621. Abraham Lincoln declared it a national holiday in 1863.', facts: ['The first Macy\'s Thanksgiving Day Parade featured live animals from the Central Park Zoo.', 'About 46 million turkeys are eaten on Thanksgiving each year.', 'The tradition of "pardoning" a turkey began with President George H.W. Bush in 1989.'] },
            { date: '2026-12-25', name: 'Christmas Day', type: 'us', history: 'A Christian holiday celebrating the birth of Jesus Christ. Many of its traditions, like Christmas trees, have pre-Christian origins.', facts: ['The song "Jingle Bells" was originally written for Thanksgiving.', 'Alabama was the first state to officially recognize Christmas in 1836.', 'The image of Santa Claus was popularized by a Coca-Cola advertising campaign in the 1930s.'] },
             // 2027
            { date: '2027-01-01', name: 'New Year\'s Day', type: 'us', history: 'The earliest recorded New Year\'s celebration dates back to ancient Babylon. It marks the start of a new year on the Gregorian calendar.', facts: ['The Times Square ball drop has been a tradition since 1907.', 'Eating black-eyed peas on New Year\'s is thought to bring good luck.', 'Many people make "New Year\'s resolutions" to improve themselves.'] },
            { date: '2027-01-18', name: 'MLK Jr. Day', type: 'us', history: 'Honors the life and legacy of civil rights leader Martin Luther King Jr. It was signed into law in 1983 and first observed in 1986.', facts: ['It is a day of national service, often referred to as a "day on, not a day off".', 'The holiday is observed on the third Monday of January.', 'Stevie Wonder\'s song "Happy Birthday" was instrumental in the campaign for the holiday.'] },
            { date: '2027-02-14', name: 'Valentine\'s Day', type: 'us', history: 'Named after St. Valentine, a Roman priest. It evolved into a day of romance from the 14th century onwards.', facts: ['Over 1 billion Valentine\'s Day cards are sent each year.', 'Richard Cadbury produced the first box of chocolates for this holiday in the late 1800s.', 'The phrase "wearing your heart on your sleeve" has medieval origins.'] },
            { date: '2027-02-15', name: 'Presidents\' Day', type: 'us', history: 'Originally established to celebrate George Washington\'s birthday. It was moved to the third Monday in February and now honors all U.S. presidents.', facts: ['It never falls on the actual birthday of any American president.', 'It\'s a popular day for car and mattress sales.', 'The official name is still "Washington\'s Birthday" for federal purposes.'] },
            { date: '2027-03-17', name: 'St. Patrick\'s Day', type: 'us', history: 'A cultural and religious holiday celebrating the patron saint of Ireland. It became a public celebration in the United States in the 18th century.', facts: ['The Chicago River is dyed green every year for the celebration.', 'The original color associated with St. Patrick was blue.', 'The world\'s shortest St. Patrick\'s Day parade is in Hot Springs, Arkansas.'] },
            { date: '2027-03-28', name: 'Easter Sunday', type: 'us', history: 'The most important Christian festival, celebrating the resurrection of Jesus Christ. The tradition of Easter eggs symbolizes new life.', facts: ['Americans spend over $2 billion on Easter candy.', 'The White House Easter Egg Roll tradition was started by President Rutherford B. Hayes.', 'The idea of the Easter Bunny originated in Germany.'] },
            { date: '2027-05-31', name: 'Memorial Day', type: 'us', history: 'Originally known as Decoration Day, it originated after the Civil War to commemorate fallen soldiers. It became a federal holiday in 1971.', facts: ['It is traditionally seen as the unofficial start of summer.', 'The "National Moment of Remembrance" occurs at 3 p.m. local time.', 'Many people wear a red poppy in remembrance of those who died in war.'] },
            { date: '2027-06-19', name: 'Juneteenth', type: 'us', history: 'Commemorates the end of slavery in the United States. It marks the day in 1865 when Union soldiers announced freedom to enslaved African Americans in Texas.', facts: ['It became a federal holiday in 2021.', 'The name is a combination of "June" and "nineteenth".', 'Common celebrations include barbecues, parades, and historical reenactments.'] },
            { date: '2027-07-04', name: 'Independence Day', type: 'us', history: 'Celebrates the adoption of the Declaration of Independence on July 4, 1776, when the United States officially separated from Great Britain.', facts: ['Three U.S. presidents have died on July 4th: John Adams, Thomas Jefferson, and James Monroe.', 'The first fireworks on July 4th were set off in 1777.', 'It is the biggest hot dog holiday of the year.'] },
            { date: '2027-09-06', name: 'Labor Day', type: 'us', history: 'A creation of the labor movement, it is dedicated to the social and economic achievements of American workers. It became a federal holiday in 1894.', facts: ['It is celebrated on the first Monday of September.', 'It is considered the unofficial end of summer.', 'The first Labor Day parade was held in New York City in 1882.'] },
            { date: '2027-10-11', name: 'Columbus Day', type: 'us', history: 'Commemorates Christopher Columbus\'s arrival in the Americas in 1492. It became a federal holiday in 1937.', facts: ['Many cities and states celebrate Indigenous Peoples\' Day instead.', 'It is celebrated in other countries as "Día de la Raza".', 'The first celebration was in 1792, 300 years after his arrival.'] },
            { date: '2027-10-31', name: 'Halloween', type: 'us', history: 'Originating from the ancient Celtic festival of Samhain, people would light bonfires and wear costumes to ward off ghosts.', facts: ['The term "trick-or-treat" dates back to the early 20th century.', 'The largest pumpkin ever recorded weighed over 2,600 pounds.', 'Scotland and Ireland still practice many ancient Halloween traditions.'] },
            { date: '2027-11-11', name: 'Veterans Day', type: 'us', history: 'Originally called "Armistice Day" to mark the end of World War I, it was changed to Veterans Day in 1954 to honor all veterans.', facts: ['It is a federal holiday and a state holiday in all states.', 'It is always observed on November 11th, regardless of the day of the week.', 'Other countries celebrate a similar holiday, like Remembrance Day.'] },
            { date: '2027-11-25', name: 'Thanksgiving', type: 'us', history: 'Celebrates the harvest feast shared by the Pilgrims and the Wampanoag people in 1621. Abraham Lincoln declared it a national holiday in 1863.', facts: ['The first Macy\'s Thanksgiving Day Parade featured live animals from the Central Park Zoo.', 'About 46 million turkeys are eaten on Thanksgiving each year.', 'The tradition of "pardoning" a turkey began with President George H.W. Bush in 1989.'] },
            { date: '2027-12-25', name: 'Christmas Day', type: 'us', history: 'A Christian holiday celebrating the birth of Jesus Christ. Many of its traditions, like Christmas trees, have pre-Christian origins.', facts: ['The song "Jingle Bells" was originally written for Thanksgiving.', 'Alabama was the first state to officially recognize Christmas in 1836.', 'The image of Santa Claus was popularized by a Coca-Cola advertising campaign in the 1930s.'] },

        ].sort((a,b) => new Date(a.date) - new Date(b.date));

        const nextMonthList = $('#nextMonthHolidayList');
        const restOfYearList = $('#restOfYearHolidayList');
        const today = new Date();
        today.setHours(0,0,0,0);
        
        const thirtyDaysFromNow = new Date();
        thirtyDaysFromNow.setDate(today.getDate() + 30);
        
        const threeMonthsFromNow = new Date();
        threeMonthsFromNow.setMonth(today.getMonth() + 3);

        nextMonthList.innerHTML = '';
        restOfYearList.innerHTML = '';

        let nextMonthCount = 0;
        let nextThreeMonthsCount = 0;
        
        const createHolidayItem = (holiday) => {
            const li = document.createElement('li');
            const dateStr = new Date(holiday.date + 'T00:00:00').toLocaleDateString('en-US', { weekday: 'short', month: 'short', day: 'numeric' });
            const dotClass = 'dot-us';
            
            li.innerHTML = `<div class="holiday-name"><span class="holiday-dot ${dotClass}"></span><strong>${holiday.name}</strong></div> <span>${dateStr}</span>`;
            li.addEventListener('click', () => showHolidayModal(holiday));
            return li;
        };

        holidays.forEach(holiday => {
            const holidayDate = new Date(holiday.date + 'T00:00:00');
            if (holidayDate >= today) {
                const holidayItem = createHolidayItem(holiday);
                if (holidayDate < thirtyDaysFromNow) {
                    nextMonthList.appendChild(holidayItem);
                    nextMonthCount++;
                } else if (holidayDate < threeMonthsFromNow) {
                    restOfYearList.appendChild(holidayItem);
                    nextThreeMonthsCount++;
                }
            }
        });
        
        if(nextMonthCount === 0){
            nextMonthList.innerHTML = '<li>No holidays in the next 30 days.</li>';
        }
        if(nextThreeMonthsCount === 0){
            restOfYearList.innerHTML = '<li>No further holidays in the following 3 months.</li>';
        }

        const viewMoreToggle = $('#viewMoreHolidays');
        const restOfYearContent = $('#restOfYearHolidays');

        viewMoreToggle.addEventListener('click', (e) => {
            e.stopPropagation();
            const icon = viewMoreToggle.querySelector('.icon');
            const parentAccordion = viewMoreToggle.closest('.accordion-card').querySelector('.accordion-content');

            if (restOfYearContent.style.maxHeight) {
                restOfYearContent.style.maxHeight = null;
                icon.style.transform = 'rotate(0deg)';
                parentAccordion.style.maxHeight = (parentAccordion.scrollHeight - restOfYearContent.scrollHeight) + "px";

            } else {
                restOfYearContent.style.maxHeight = restOfYearContent.scrollHeight + "px";
                icon.style.transform = 'rotate(180deg)';
                parentAccordion.style.maxHeight = (parentAccordion.scrollHeight + restOfYearContent.scrollHeight) + "px";
            }
        });
    };

    // --- Holiday Modal ---
    const holidayModal = $('#holidayModal');
    const modalCloseBtn = $('#modalClose');

    const showHolidayModal = (holidayData) => {
        $('#modalTitle').textContent = holidayData.name;
        $('#modalHistory').textContent = holidayData.history;
        const factsList = $('#modalFacts ul');
        factsList.innerHTML = '';
        holidayData.facts.forEach(fact => {
            const li = document.createElement('li');
            li.textContent = fact;
            factsList.appendChild(li);
        });
        holidayModal.classList.add('visible');
    };
    
    const hideHolidayModal = () => {
        holidayModal.classList.remove('visible');
    };

    modalCloseBtn.addEventListener('click', hideHolidayModal);
    holidayModal.addEventListener('click', (e) => {
        if (e.target === holidayModal) {
            hideHolidayModal();
        }
    });


    fetchWeather();
    initHolidayWidget();
    setInterval(fetchWeather, 30 * 60 * 1000); // Refresh every 30 minutes
});

</script>
</body>
</html>
