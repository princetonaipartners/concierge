<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Hamilton Deli & Grill — Rewards Sign-up</title>
<style>
  body{margin:0;background:#0b1020;color:#e8ecff;font-family:system-ui,Segoe UI,Inter,Roboto,Arial}
  .wrap{max-width:520px;margin:32px auto;padding:0 16px}
  .card{background:#101629;border-radius:16px;padding:20px;box-shadow:0 10px 30px rgba(0,0,0,.35)}
  h1{margin:0 0 8px} .sub{color:#9aa3b2;margin:0 0 14px}
  .field{display:flex;flex-direction:column;gap:6px;margin:10px 0}
  label{font-weight:700}
  input[type="text"],input[type="tel"],input[type="email"]{
    background:#0e1425;border:1px solid #243055;border-radius:12px;color:#fff;padding:14px;font-size:16px
  }
  .hint{color:#9aa3b2;font-size:13px}
  button{width:100%;padding:14px;border:none;border-radius:12px;background:linear-gradient(180deg,#5fe1a5,#55c9ff);color:#08111f;font-weight:800;font-size:16px;cursor:pointer;margin-top:14px}
  .banner{display:none;margin:10px 0;padding:12px;border-radius:12px;font-weight:700}
  .ok{background:#123724;color:#9ff3c9;border:1px solid #1f6b49}
  .err{background:#3d0f17;color:#ffd0d8;border:1px solid #8f2236}
</style>
</head>
<body>
<div class="wrap">
  <div class="card" id="card">
    <h1>Join Hamilton Rewards</h1>
    <p class="sub">Earn a free Coffee or 20oz drink every 5 visits. SMS is optional.</p>

    <div id="ok" class="banner ok"></div>
    <div id="err" class="banner err"></div>

    <form id="f" novalidate>
      <div class="field">
        <label for="phone">Phone number *</label>
        <input id="phone" type="tel" inputmode="tel" placeholder="(555) 123-4567" autocomplete="tel" required>
        <div class="hint">We use the last 10 digits at checkout.</div>
      </div>
      <div class="field">
        <label for="name">Full name *</label>
        <input id="name" type="text" placeholder="Jane Doe" required>
      </div>
      <div class="field">
        <label for="birthday">Birthday (YYYY-MM-DD) *</label>
        <input id="birthday" type="text" inputmode="numeric" placeholder="1990-06-15" maxlength="10" required>
      </div>
      <div class="field">
        <label for="email">Email (optional)</label>
        <input id="email" type="email" placeholder="jane@example.com" autocomplete="email">
      </div>
      <label style="display:flex;align-items:center;gap:10px;margin-top:8px">
        <input id="sms" type="checkbox"> I agree to receive reward & offers SMS
      </label>

      <button type="submit">Join</button>
    </form>
  </div>
</div>

<script>
const WEBHOOK_SIGNUP = 'https://princetonai.app.n8n.cloud/webhook/cashier-signup';

const $ = q => document.querySelector(q);
const digits10 = v => { const d = String(v||'').replace(/\D/g,''); return d.length>=10? d.slice(-10): null; };

$('#f').addEventListener('submit', async (e)=>{
  e.preventDefault();
  $('#ok').style.display = 'none'; $('#err').style.display='none';

  const phone10 = digits10($('#phone').value);
  const name    = $('#name').value.trim();
  const bday    = $('#birthday').value.trim();
  const email   = $('#email').value.trim();
  const sms     = $('#sms').checked;

  if (!phone10 || !name || !/^\d{4}-\d{2}-\d{2}$/.test(bday)) {
    $('#err').textContent = 'Please complete all required fields with valid values.';
    $('#err').style.display = 'block'; return;
  }

  try{
    const r = await fetch(WEBHOOK_SIGNUP,{
      method:'POST', headers:{'Content-Type':'application/json'},
      body: JSON.stringify({ phone: phone10, name, birthday: bday, email, smsOptin: sms })
    });
    if(!r.ok) throw new Error(`HTTP ${r.status}`);
    const res = await r.json();

    if (res.success){
      $('#ok').textContent = res.message || 'You’re all set! Tell the cashier your phone number at checkout.';
      $('#ok').style.display = 'block';
      $('#f').reset();
    } else {
      $('#err').textContent = res.message || 'Could not sign up. Please try again.';
      $('#err').style.display = 'block';
    }
  }catch(err){
    console.error(err);
    $('#err').textContent = 'Network error. Please try again.';
    $('#err').style.display = 'block';
  }
});
</script>
</body>
</html>
